import{l as f,C as S,c as n,a as p,u as b,w as v,F as g,o as l,d as j,e,t as o,n as y,g as x,q as w,i as k,p as A,b as T,E as V,G as h}from"./app-BntOCUSP.js";import{_ as $}from"./AuthenticatedLayout-hhq0HCAA.js";import{d as q}from"./index-BtyV_COL.js";/* empty css                    */const B={class:"flex flex-col md:flex-row gap-6 bg-white shadow-sm sm:rounded-lg p-6"},F={class:"w-full md:w-2/3 border border-gray-300 p-4 rounded-md"},M={class:"grid grid-cols-1 md:grid-cols-2 gap-4"},G={class:"text-gray-600"},O={class:"text-gray-600"},P={class:"mt-4"},U={class:"text-gray-600"},L={class:"w-full md:w-1/3 border border-gray-300 p-4 rounded-md"},I={key:0,class:"rounded-b-lg mt-4"},H={id:"task-comments",class:"pt-4"},J={class:"bg-white rounded-lg p-3 flex flex-col justify-center items-center md:items-start shadow-lg mb-4"},K={class:"flex flex-row justify-center mr-2"},Q={class:"text-black font-semibold text-lg text-center md:text-left"},R={style:{width:"90%"},class:"text-gray-600 text-lg text-center md:text-left"},W={key:0,class:"fixed inset-0 bg-gray-600 bg-opacity-50 flex justify-center items-center z-50"},X={class:"bg-white p-6 rounded shadow-lg w-96"},Y={class:"mb-4"},Z=["value"],_={class:"mt-4 flex justify-end gap-2"},ee=["disabled"],ae={__name:"Show",props:{incidencia:{type:Object,required:!0}},setup(s){const d=s,r=q.useToast(),c=f(!1),u=f(""),C=["Pendiente","En proceso","Finalizada"],m=S({comentario:""}),E=()=>{if(!d.incidencia||!d.incidencia.id){r.error("No se pudo actualizar el estado porque falta información de la incidencia.");return}h.put(route("ticket.update",d.incidencia.id),{estado:u.value},{onSuccess:()=>{r.success("El estado del ticket ha sido actualizado."),c.value=!1},onError:a=>{r.error("Ocurrió un error al actualizar el estado."),console.error(a)}})},z=a=>a.replace(/[.,\/#!$%\^&\*;:{}=\-_`~()]/g,"").replace(/\s{2,}/g," "),D=()=>{console.log("Aca",d.incidencia.id);let a=z(m.comentario);a.trim()?h.post(route("comentarios.store",d.incidencia.id),{comentario:a},{onSuccess:()=>{r.success("Comentario guardado exitosamente."),m.comentario=""},onError:t=>{r.error("Ocurrió un error al guardar el comentario."),console.error(t)}}):alert("El comentario no puede estar vacío.")};return(a,t)=>(l(),n(g,null,[p(b(j),{title:"Detalle de Ticket"}),p($,null,{header:v(()=>t[4]||(t[4]=[e("div",{class:"text-center w-full mb-4"},[e("h1",{class:"font-semibold text-xl mb-2"},"Detalle del Ticket"),e("hr",{class:"my-2 border-t-1 border-gray-900 w-full mx-auto"})],-1)])),default:v(()=>[e("div",B,[e("div",F,[t[10]||(t[10]=e("h2",{class:"text-lg font-semibold mb-4"},"Ticket",-1)),e("div",M,[e("div",null,[t[5]||(t[5]=e("p",{class:"font-semibold text-gray-700 mb-1"},"Asunto:",-1)),e("p",G,o(s.incidencia.titulo),1)]),e("div",null,[t[6]||(t[6]=e("p",{class:"font-semibold text-gray-700 mb-1"},"Estado:",-1)),e("p",null,[e("span",{class:y(["inline-block px-2 py-1 text-sm font-medium text-white rounded",{"bg-red-600":s.incidencia.estado==="Pendiente","bg-orange-500":s.incidencia.estado==="En proceso","bg-green-600":s.incidencia.estado==="Finalizada"}])},o(s.incidencia.estado),3),a.$page.props.user.permissions.includes("Cambiar estado ticket")?(l(),n("button",{key:0,onClick:t[0]||(t[0]=i=>c.value=!0),class:"ml-4 px-3 py-1 bg-blue-600 text-white text-sm rounded hover:bg-blue-500"}," Actualizar estado ")):x("",!0)])]),e("div",null,[t[7]||(t[7]=e("p",{class:"font-semibold text-gray-700 mb-1"}," Descripción : ",-1)),e("p",O,o(s.incidencia.descripcion),1)]),e("div",null,[t[8]||(t[8]=e("p",{class:"font-semibold text-gray-700 mb-1"}," Nivel de prioridad: ",-1)),e("p",null,[e("span",{class:y(["inline-block px-2 py-1 text-sm font-medium text-white rounded",{"bg-red-600":s.incidencia.criticidad==="Alta","bg-orange-500":s.incidencia.criticidad==="Media","bg-blue-500":s.incidencia.criticidad==="Baja"}])},o(s.incidencia.criticidad),3)])])]),e("div",P,[t[9]||(t[9]=e("p",{class:"font-semibold text-gray-700 mb-1"}," Dependencia solicitante: ",-1)),e("p",U,o(s.incidencia.dependencia),1)])]),e("div",L,[e("div",null,[s.incidencia.comentariosUsuarios.length>0?(l(),n("section",I,[t[11]||(t[11]=e("div",{class:"mt-4"},[e("h2",{class:"text-lg font-semibold mb-4"},"Comentarios anteriores")],-1)),e("ul",null,[(l(!0),n(g,null,w(s.incidencia.comentariosUsuarios,(i,N)=>(l(),n("li",{key:N},[e("div",H,[e("div",J,[e("div",K,[e("h3",Q," @"+o(i.usuario),1)]),e("p",R,o(i.comentario),1)])])]))),128))])])):x("",!0)]),k(e("textarea",{"onUpdate:modelValue":t[1]||(t[1]=i=>b(m).comentario=i),class:"w-full shadow-inner p-4 border-0 mb-4 rounded-lg focus:shadow-outline text-2xl",placeholder:"Comenta aquí",cols:"6",rows:"4",id:"comment_content",spellcheck:"false"},null,512),[[A,b(m).comentario]]),e("button",{onClick:D,class:"font-bold py-2 px-4 w-full bg-green-800 text-lg text-white shadow-md rounded-lg"},"Guardar ")])]),c.value?(l(),n("div",W,[e("div",X,[t[14]||(t[14]=e("h2",{class:"text-lg font-semibold mb-4 text-center"}," Actualizar Estado ",-1)),e("p",Y,[t[12]||(t[12]=e("span",{class:"font-semibold"},"Incidencia:",-1)),T(" "+o(s.incidencia.titulo),1)]),t[15]||(t[15]=e("label",{class:"block mb-2 font-semibold text-gray-700"}," Nuevo Estado: ",-1)),k(e("select",{"onUpdate:modelValue":t[2]||(t[2]=i=>u.value=i),class:"w-full p-2 border border-gray-300 rounded-md"},[t[13]||(t[13]=e("option",{value:"",disabled:""},"Selecciona un estado",-1)),(l(),n(g,null,w(C,i=>e("option",{key:i,value:i},o(i),9,Z)),64))],512),[[V,u.value]]),e("div",_,[e("button",{onClick:t[3]||(t[3]=i=>c.value=!1),class:"px-4 py-2 bg-gray-500 text-white rounded hover:bg-gray-400"}," Cancelar "),e("button",{onClick:E,disabled:!u.value,class:"px-4 py-2 bg-blue-600 text-white rounded hover:bg-blue-500 disabled:opacity-50"}," Actualizar ",8,ee)])])])):x("",!0)]),_:1})],64))}};export{ae as default};
